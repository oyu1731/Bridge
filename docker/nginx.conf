# nginx.conf
# このファイルはNginxウェブサーバーの設定を定義します。
# 主に、Flutterの静的ファイルを配信し、バックエンドAPIへのリバースプロキシとして機能します。
#
# チームメンバーへ:
#   - Nginxは、クライアントからのリクエストを適切なサービス（FlutterのWebアプリまたはSpring Boot API）に
#     ルーティングする役割を担います。
#   - `location /` はFlutterのWebアプリケーションの静的ファイル配信を担当し、
#     `location /api/` はSpring Bootバックエンドへのリクエストを転送します。

server {
    listen 80; # 80番ポートでリクエストをリッスン

    # ルートパス (例: /) へのリクエスト処理
    location / {
        root /usr/share/nginx/html; # Flutterのビルド済みWebファイルが配置されるディレクトリ
        index index.html; # デフォルトのインデックスファイル
        try_files $uri $uri/ /index.html; # ファイルが見つからない場合にindex.htmlを返す (SPA対応)
    }

    # /api/ パスへのリクエスト処理
    # Spring Bootバックエンドへのリバースプロキシ設定
    location /api/ {
        # リクエストをDockerネットワーク内の `backend` サービス (ポート8081) に転送
        # 注意: docker-compose.ymlでbackendサービスは8080ポートで公開されていますが、
        # ここでは8081となっています。もしbackendサービスが8080でリッスンしている場合、
        # ここも `http://backend:8080/` に修正する必要があります。
        proxy_pass http://backend:8080/; # Spring Bootバックエンドは8080ポートでリッスンしています
    }
}
